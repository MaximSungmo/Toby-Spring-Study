# UserDaoTest 다시 보기

### 테스트의 유용성

이전에 만들었던 테스트 코드는 main() 메소드를 이용해 UserDao 오브젝트의 add(), get() 메소드를 호출하고, 그 결과를 화면에 출력해서 그 값을 눈으로 확인시켜줬다.

이러한 과정은 내가 예상하고 의도했던 대로 코드가 정확히 동작하는지를 확인해서 만든 코드를 확신할 수 있게 해주는 작업이다.

또한 테스트의 결과가 원하는 대로 나오지 않는 경우에는 코드나 설계에 결함이 있음을 알 수 있다. 이를 통해 코드의 결함을 제거해가는 작업, 일명 디버깅을 거치게 되고, 결국 최종적으로 테스트가 성공하면 모든 결함이 제거됐다는 확신을 얻을 수 있다.

### UserDaoTest의 특징

```java
public class UserDaoTest {
  public static void main(String[] args) throws SQLException {
    ApplicationContext context = new GenericXmlApplicationContext("applicationContext.xml");

    UserDao dao = context.getBean("userDao", UserDao.class);

    User user = new User();
    user.setId("user");
    user.setName("박필");
    user.setPassword("1234");

    dao.add(user);

    System.out.println(user.getId() + "등록 성공");

    User user2 = dao.get(user.getId());
    System.out.println(user.getName());
    System.out.println(user.getPassword());

    System.out.println(user2.getId() + "조회 성공");
  }
}
```

이 테스트 코드의 내용을 정리해보면 다음과 같다.

* 자바에서 가장 손쉽게 실행 가능한 main() 메소드를 이용한다.
* 테스트할 대상인 UserDao의 오브젝트를 가져와 메소드를 호출한다.
* 테스트에 사용할 입력 값(User 오브젝트)을 직접 코드에서 만들어 넣어준다.
* 테스트의 결과를 콘솔에 출력해준다.
* 각 단계의 작업이 에러 없이 끝나면 콘솔에 성공 메시지로 출력해준다.

이 중 가장 돋보이는 방법은 main() 메소드를 이용해 쉽게 테스트를 수행했다는 것과, 테스트할 대상인 UserDao를 직접 호출해 사용한다는 점이다.

**웹을 통한 DAO 테스트 방법의 문제점**

보통 웹 프로그램에서사용하는 DAO를 테스트하는 방법은 다음과 같다.

* DAO를 만든다.
* 서비스, MVC 프레젠테이션 계층까지 포함한 모든 입출력 기능을 대충이라도 코드로 만든다.
* 만들어진 테스트용 웹 애플리케이션을 서버에 배치한다.
* 웹 화면을 띄워 폼을 열고 값을 입력한 뒤 등록한다.
* 해당 폼의 값을 받아 파싱한 뒤 User 오브젝트로 만들어 UserDao를 호출한다.

이러한 방식의 테스트는 가장 흔히 쓰이는 방법이긴 하나 DAO에 대한 테스트로서는 단점이 너무 많다. DAO를 위해 다른 계층의 기능까지 완성되어야 하기 때문이다.

**작은 단위의 테스트**

테스트 하고자 하는 대상이 명확하다면 그 대상에만 집중해서 테스트하는 것이 바람직하다. 관심사의 분리라는 원리를 적용해 가능하면 작은 단위로 쪼개서 집중해야 한다.

UserDaoTest는 한 가지 관심에 집중할 수 있게 작은 단위로 만들어진 테스트다. UserDaoTest의 테스트를 수행할 때는 웹 인터페이스나, 그것을 위한 MVC 클래스, 서비스 오브젝트 등이 필요없다. 서버에 배포할 필요도 없다. 간단히 IDE나 도스창에서도 테스트 수행이 가능하다. 에러가 나거나 원치 않는 결과가 나온다면 그것은 UserDao 코드나 아니면 DB 연결방법 정도에서 문제가 있는 것이니 원인을 빠르게 찾아낼 수 있다.

이렇게 작은 단위의 코드에 대해 테스트를 수행한 것을 단위테스트(Unit Test) 라고 한다. 여기서 말하는 단위란 무엇인지, 그 크기와 범위가 어느 정도인지 정해진 것은 아니다. 크게는 사용자 관리 기능을 통틀어서 하나의 단위로 볼 수도 있고, 작게는 add() 메소드 하나만 가지고 하나의 단위라고 생각할 수도 있다.
충분히 하나의 관심에 집중해서 효율적으로 테스트할 만한 범위의 단위라고 보면 된다.

**자동수행 테스트 코드**

UserDaoTest의 한가지 특징은 테스트할 데이터가 코드를 통해 제공되고, 테스트 작업 역시 코드를 통해 자동으로 실행한다는 점이다. User 오브젝트를 만들어 적절한 값을 넣고, DB 연결 준비가 되어있는 UserDao 오브젝트를 스프링 컨테이너에서 가져와 add()를 호출하고, 그 키 값으로 get()을 호출하는 것까지 자동으로 진행된다.

이렇게 테스트는 자동으로 수행되도록 코드로 만들어지는 것이 중요하다. 자동으로 수행되는 테스트의 장점은 자주 반복할 수 있다는 것이다.

### UserDaoTest의 문제점

* 수동 확인 작업의 번거로움
 UserDaoTest는 수행 과정과 입력 데이터의 준비를 모두 자동으로 진행하도록 만들어졌다. 하지만 여전히 사람의 눈으로 확인하는 과정이 필요하다.

 즉, 테스트의 결과를 확인하는 일은 사람의 책임이므로 완전한 자동화 테스트라 말할 수 없다는 것이다. 또한, 검증해야 하는 양이 많고 복잡해지면 역시 불편함을 느낄 수 밖에 없고 작은 차이는 미처 발견하지 못하고 넘어가는 실수를 할 가능성도 있다.

* 실행 작업의 번거로움
 아무리 간단히 실행 가능한 main() 메소드라고 하더라도 매번 그것을 실행하는 것은 제법 번거롭다. 만약 DAO가 수백 개가 되고 그에 대한 main() 메소드도 그만큼 만들어진다면 전체 기능을 테스트해보기 위해 main() 메소드를 수백 번 실행하는 수고가 필요하다.
